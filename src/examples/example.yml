description: >
  Examples demonstrating the syft-orb commands and jobs.

usage:
  version: 2.1
  orbs:
    syft: juburr/syft-orb@latest
  jobs:
    # Example 1: Single format with auto-generated output
    # Outputs to: sboms/static-latest.spdx.json
    command-single-format:
      docker:
        - image: cimg/base:current-22.04
      steps:
        - syft/install
        - syft/generate_sbom:
            source: gcr.io/distroless/static:latest
            output_formats: spdx-json
        # Log a single SBOM file by path
        - syft/log_sbom:
            sbom_path: sboms/static-latest.spdx.json
        # Or log all SBOMs in a directory (auto-detects format from extension)
        - syft/log_sbom:
            sbom_dir: sboms

    # Example 2: Multiple formats in a single scan
    # Outputs to: sboms/static-latest.spdx.json AND sboms/static-latest.cdx.json
    command-multi-format:
      docker:
        - image: cimg/base:current-22.04
      steps:
        - syft/install
        - syft/generate_sbom:
            source: gcr.io/distroless/static:latest
            output_formats: "spdx-json,cyclonedx-json"
        - syft/log_sbom:
            sbom_dir: sboms

    # Example 3: Multiple formats with custom output directory
    # Outputs to: artifacts/static-latest.spdx.json AND artifacts/static-latest.cdx.json
    command-custom-directory:
      docker:
        - image: cimg/base:current-22.04
      steps:
        - syft/install
        - syft/generate_sbom:
            source: gcr.io/distroless/static:latest
            output_dir: artifacts
            output_formats: "spdx-json,cyclonedx-json,syft-json"

    # Example 4: Build RPMs and persist to workspace
    build-rpms:
      docker:
        - image: cimg/base:current-22.04
      steps:
        - checkout
        - run:
            name: Build RPM packages
            command: echo "Build your RPMs here"
        - persist_to_workspace:
            root: .
            paths:
              - rpms/

  workflows:
    example-workflow:
      jobs:
        # Command-based examples
        - command-single-format
        - command-multi-format
        - command-custom-directory

        # Job-based example: Source code SBOM
        # Captures dependencies from package.json, go.mod, requirements.txt, etc.
        # that may not be present in compiled/transpiled artifacts.
        # Generates both SPDX and CycloneDX formats by default.
        - syft/sbom:
            name: sbom-source
            source: "dir:."
            attach_workspace: false
            persist_to_workspace: true

        # Job-based example: Source code SBOM with single format
        - syft/sbom:
            name: sbom-source-spdx-only
            source: "dir:."
            output_formats: "spdx-json"
            attach_workspace: false
            persist_to_workspace: true

        # Job-based examples: Generate SBOMs for RPM packages
        - build-rpms
        - syft/sbom:
            name: sbom-rpm-el9
            source: "rpms/myapp*.el9.x86_64.rpm"
            requires:
              - build-rpms

        # Job-based example: noarch RPM with three formats
        - syft/sbom:
            name: sbom-rpm-noarch
            source: "rpms/myapp-config*.noarch.rpm"
            output_formats: "spdx-json,cyclonedx-json,syft-json"
            requires:
              - build-rpms

        # Job-based example: Container image (no workspace needed)
        - syft/sbom:
            name: sbom-container
            source: "gcr.io/distroless/static:latest"
            attach_workspace: false
            persist_to_workspace: false

        # Job-based example: DEB package
        - syft/sbom:
            name: sbom-deb
            source: "debs/myapp_*_amd64.deb"
            requires:
              - build-rpms
