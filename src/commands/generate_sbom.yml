description: Generates Software Bill of Materials (SBOM)
parameters:
  base_path:
    type: string
    default: ""
    description: Override the default base path for SBOM generation. The orb automatically sets this if left blank.
  enrich:
    type: enum
    default: all
    description: Enable package data enrichment from local and online sources,
      to include additional metadata such as licenses, URLs, and more.
    enum: ["none", "all", "golang", "java", "javascript", "python"]
  source:
    type: string
    description: The container image URI, RPM filename, DEB filename, or filesystem directory to scan.
  output_file:
    type: string
    default: ""
    description: |
      Output file path for the SBOM. Supports three modes:
        - Empty (default): Auto-generates filename in sboms/ directory (e.g., sboms/myapp-1.0.0.spdx.json)
        - Trailing slash: Auto-generates filename in specified directory (e.g., "custom/" â†’ custom/myapp-1.0.0.spdx.json)
        - Explicit path: Uses the specified path as-is (e.g., "my-sbom.json")
      The auto-generated filename is derived from the source (package name for RPM/DEB, image name for containers, directory name for paths) with a format-appropriate suffix.
  output_format:
    type: enum
    default: spdx-json
    description: Output format of the SBOM. Should allow an array; use a single value enum for now.
    enum: ["cyclonedx-json", "cyclonedx-xml", "github-json", "purls", "spdx-json", "spdx-tag-value", "syft-json", "syft-table", "syft-text", "template"]
  scope:
    type: enum
    default: squashed
    description: Selection of layers to catalog.
    enum: ["squashed", "all-layers"]
steps:
  - run:
      name: Generate SBOM
      environment:
        PARAM_BASE_PATH: << parameters.base_path >>
        PARAM_ENRICH: << parameters.enrich >>
        PARAM_SOURCE: << parameters.source >>
        PARAM_OUTPUT_FILE: << parameters.output_file >>
        PARAM_OUTPUT_FORMAT: << parameters.output_format >>
        PARAM_SCOPE: << parameters.scope >>
      shell: /bin/bash
      command: << include(scripts/generate_sbom.sh) >>
