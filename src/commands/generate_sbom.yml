description: Generates Software Bill of Materials (SBOM) in one or more formats simultaneously
parameters:
  base_path:
    type: string
    default: ""
    description: Override the default base path for SBOM generation. The orb automatically sets this if left blank.
  enrich:
    type: enum
    default: all
    description: Enable package data enrichment from local and online sources,
      to include additional metadata such as licenses, URLs, and more.
    enum: ["none", "all", "golang", "java", "javascript", "python"]
  source:
    type: string
    description: The container image URI, RPM filename, DEB filename, or filesystem directory to scan.
  output_dir:
    type: string
    default: ""
    description: |
      Output directory path for the SBOM files. Supports two modes:
        - Empty (default): Auto-generates filenames in sboms/ directory (e.g., sboms/myapp-1.0.0.spdx.json)
        - Specified path: Auto-generates filenames in the specified directory (e.g., "custom/" â†’ custom/myapp-1.0.0.spdx.json)
      The auto-generated filename is derived from the source (package name for RPM/DEB, image name for containers, directory name for paths) with a format-appropriate suffix.
  output_formats:
    type: string
    default: spdx-json
    description: |
      Comma-separated list of output formats to generate. Syft scans once and generates all formats simultaneously.
      Examples: "spdx-json" (single), "spdx-json,cyclonedx-json" (multiple)
      Supported formats: cyclonedx-json, cyclonedx-xml, github-json, purls, spdx-json, spdx-tag-value, syft-json, syft-table, syft-text, template
  scope:
    type: enum
    default: squashed
    description: Selection of layers to catalog.
    enum: ["squashed", "all-layers"]
steps:
  - run:
      name: Generate SBOM
      environment:
        PARAM_BASE_PATH: << parameters.base_path >>
        PARAM_ENRICH: << parameters.enrich >>
        PARAM_SOURCE: << parameters.source >>
        PARAM_OUTPUT_DIR: << parameters.output_dir >>
        PARAM_OUTPUT_FORMATS: << parameters.output_formats >>
        PARAM_SCOPE: << parameters.scope >>
      shell: /bin/bash
      command: << include(scripts/generate_sbom.sh) >>
